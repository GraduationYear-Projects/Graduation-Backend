(()=>{var e=function(e){return e.replace(/_/g,":")},t=/(\/b|\/s|\/l).*(node=)(\d{1,12})/,i=new Map,n=function(){if(!i.has(window.location.href)){var e=t.exec(window.location.href),n=e&&e[3]?e[3]:null;i.set(window.location.href,n)}return i.get(window.location.href)},a=function(e){var t=n();if(!e||!t)return null;var i=e.split(":");return i.splice(i.length-1,0,t),i.join(":")},s=function(e){var t=n();return t?"".concat(e,":").concat(t):null},o={wb:"ues",bb:"uet",af:"uet",cf:"uet",be:"uet",ld:"uex"},r=function(t){var i,n,o=t.latencyEvent,r=t.scope,m=t.placement,p=t.timestamp;d(o)&&(l(o,c(r),m.id,p),l(o,c(r),e(m.name),p),l(o,c(r),null!==(i=a(m.name))&&void 0!==i?i:void 0,p),l(o,c(r),null!==(n=s(m.id))&&void 0!==n?n:void 0,p))},d=function(e){return"function"==typeof window[o[e]]},l=function(e,t,i,n){void 0===n&&(n=new Date);var a=o[e];i&&"function"==typeof window[a]&&window[a](e,t+i,{wb:1},n)},c=function(e){return"adplacements:"+m(e)},m=function(e){return e?"".concat(e,":"):""},p=function(e){console.debug(e)},h=function(e,t){console.error(e,JSON.stringify(t)),u("ERROR",e,v(e,t))},u=function(e,t,i){var n;null===(n=window.ueLogError)||void 0===n||n.call(window,i,{logLevel:e,attribution:"APE-safeframe",message:t+" | "})},v=function(e,t){return t instanceof Error?t:t?new Error(t):new Error(e)},w=function(e,t,i){if(window.csa)try{window.csa("Content",{element:e})("mark",t,null==i?void 0:i.getTime())}catch(n){h("Error with 'mark' CSA",n)}};class f{sendLatencyMetric({latencyMetricType:e,placementId:t,placementName:i,placementDivId:n,timestamp:a}){r({latencyEvent:e.csmKey,scope:e.csmMessage,placement:{id:t,name:i},timestamp:a}),w(document.getElementById(n),e.csaKey,a)}}const g=()=>new f;function y(e,t,i){var n,a=i||{},s=a.noTrailing,o=void 0!==s&&s,r=a.noLeading,d=void 0!==r&&r,l=a.debounceMode,c=void 0===l?void 0:l,m=!1,p=0;function h(){n&&clearTimeout(n)}function u(){for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];var r=this,l=Date.now()-p;function u(){p=Date.now(),t.apply(r,a)}function v(){n=void 0}m||(d||!c||n||u(),h(),void 0===c&&l>e?d?(p=Date.now(),o||(n=setTimeout(c?v:u,e))):u():!0!==o&&(n=setTimeout(c?v:u,void 0===c?e-l:e)))}return u.cancel=function(e){var t=(e||{}).upcomingOnly,i=void 0!==t&&t;h(),m=!i},u}const b=(e,t,i)=>(...n)=>{try{e(...n)}catch(a){null==t||t(i||"Error in handler",a)}},I=/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/,S=e=>I.test(e),A=e=>S(e)?x(e):e,E=e=>S(e)?e:M(e),M=e=>btoa(unescape(encodeURIComponent(e))),x=e=>decodeURIComponent(escape(atob(e))),k=e=>e&&0===Object.keys(e).length&&e.constructor===Object;var T=function(t,i,n){var o,r,d,l,c,m;if(void 0===n&&(n=1),!L())return window.safeframe=null!==(o=window.safeframe)&&void 0!==o?o:{},window.safeframe.csmCache=null!==(r=window.safeframe.csmCache)&&void 0!==r?r:{},window.safeframe.csmCache.incrementCsmPlacementCounter=null!==(d=window.safeframe.csmCache.incrementCsmPlacementCounter)&&void 0!==d?d:[],void window.safeframe.csmCache.incrementCsmPlacementCounter.push({metric:t,placement:i,count:n});null===(m=null===(c=null===(l=window.safeframe)||void 0===l?void 0:l.csmCache)||void 0===c?void 0:c.incrementCsmPlacementCounter)||void 0===m||m.forEach((function(e){return T(e.metric,e.placement,e.count)}));var p=function(e,t,i){t&&D("".concat(z(e),":").concat(t),i)};p(t,i.id,n),p(t,s(i.id),n),p(t,e(i.name),n),p(t,a(e(i.name)),n)},N=function(e,t){var i,n,a,s,o,r;if(void 0===t&&(t=1),!L())return window.safeframe=null!==(i=window.safeframe)&&void 0!==i?i:{},window.safeframe.csmCache=null!==(n=window.safeframe.csmCache)&&void 0!==n?n:{},window.safeframe.csmCache.incrementCsmCounter=null!==(a=window.safeframe.csmCache.incrementCsmCounter)&&void 0!==a?a:[],void window.safeframe.csmCache.incrementCsmCounter.push({metric:e,count:t});null===(r=null===(o=null===(s=window.safeframe)||void 0===s?void 0:s.csmCache)||void 0===o?void 0:o.incrementCsmCounter)||void 0===r||r.forEach((function(e){return N(e.metric,e.count)})),D(z(e),t)},L=function(){var e;return"function"==typeof(null===(e=null===window||void 0===window?void 0:window.ue)||void 0===e?void 0:e.count)},D=function(e,t){var i;return null===(i=null===window||void 0===window?void 0:window.ue)||void 0===i?void 0:i.count(e,t)},C="adplacements",z=function(e){return e.startsWith(C)?e:"".concat(C,":").concat(e)};const _=(e,t)=>{const i=e,n=i[t].options;if(k(i))return N("getiframe:admap:empty"),null;if(k(n))return N("getiframe:addetails:empty"),null;i[t]&&!k(i[t])||N("getiframe:admap:adinfo:undefinedorempty");const a=`ape_${n.scope}_iframe`;var s,o;i[t].iframe?(null===(o=i[t])||void 0===o||null===(s=o.iframe)||void 0===s?void 0:s.innerHTML)?N("getiframe:admap:iframe:innerhtml:exist"):(N("getiframe:admap:iframe:innerhtml:undefined"),i[t].iframe=document.getElementById(a),document.getElementById(a)||N("getiframe:getElementById:undefined")):N("getiframe:admap:iframe:undefined");return i[t].iframe},F=[{p:50,t:2,def:"iab"}],R=[{p:0,t:0,def:"amzn"},{p:50,t:1,def:"iab"},{p:100,t:1,def:"groupm"}],H=[{p:0,t:0,def:"amzn"},{p:30,t:1,def:"iab"},{p:100,t:1,def:"groupm"}],B=()=>window.innerHeight||document.documentElement.clientHeight,$=()=>window.innerWidth||document.documentElement.clientWidth,W=e=>e.getBoundingClientRect().top-B(),O=(e,t)=>({t:e.top,l:e.left,r:e.right,b:e.bottom,w:e.width,h:e.height,z:t}),U=e=>{const t=e.getBoundingClientRect();return O(t,Number(window.getComputedStyle(e,null).zIndex))},q=e=>{const t=K(e);return{t:e.t,l:e.l,r:e.r,b:e.b,w:e.w,h:e.h,z:e.z,xiv:t.xiv,yiv:t.yiv,iv:t.iv}},V=()=>{const e=window.screenY?window.screenY:window.screenTop,t=window.screenX?window.screenX:window.screenLeft,i=$(),n=B();return{t:e,l:t,w:i,h:n,b:e+n,r:t+i}},J=e=>{const t=V(),i=(e=>q(U(e)))(e),n=X(e);return{atf:Y(e),geom:{win:t,self:i,exp:n},payload:{wh:t.h,ww:t.w,sx:window.scrollX,sy:window.scrollY,ah:i.h,aw:i.w,top:i.t,left:i.l}}},Y=e=>{const t=function(e){const t=document.body.getBoundingClientRect();if(j(t))return null;const i=U(e),n=B(),a=$(),s=Math.max(0,Math.min(t.left+a,i.r)-i.l),o=Math.max(0,Math.min(t.top+n,i.b)-i.t),r=s*o/(i.h*Math.min(i.w,a));return Number(Math.min(1,Math.max(0,r)).toFixed(2))}(e);return null==t?"unknown":t>=.5},j=e=>0===e.width&&0===e.height;const K=e=>{const t=$(),i=B(),n=Math.max(0,Q(e.t,e.b,i)),a=Math.max(0,Q(e.l,e.r,t)),s=n*a,o=e.h*Math.min(e.w,t);return 0!==o||0!==s?{xiv:Number(Math.min(1,a/e.w).toFixed(2)),yiv:Number(Math.min(1,n/e.h).toFixed(2)),iv:Number(Math.min(1,Math.max(0,s/o)).toFixed(2))}:{xiv:0,yiv:0,iv:0}},X=e=>{const t=e.getBoundingClientRect();return G(t)},G=e=>({t:e.top,l:e.left,r:$()-e.right,b:B()-e.bottom,xs:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth)>$()?1:0,yx:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)>B()?1:0}),Z=e=>G(e),Q=(e,t,i)=>{let n=0;return"visible"!==document.visibilityState?n:(n=e>0?i-e:t>0?Math.min(t,i):0,Math.min(n,t-e))},ee=(e,t)=>{const i=U(e),n=U(t),a=$(),s=B();return i&&n&&(Math.abs(i.t-n.b)<s||Math.abs(i.b-n.t)<s)&&(Math.abs(i.l-n.r)<a||Math.abs(i.r-n.l)<a)},te=(e,t)=>{const i=parseInt(t.height)*parseInt(t.width)>=242500;return"V"===e?F:i?H:R},ie=e=>{const t=ne(e),i=V(),n=q(O(t,NaN));return{atf:"unknown",geom:{win:i,self:n,exp:Z(t)},payload:{wh:i.h,ww:i.w,sx:window.scrollX,sy:window.scrollY,ah:n.h,aw:n.w,top:n.t,left:n.l}}},ne=e=>{const t=e.initialBoundingRect,i=t.top-(window.scrollY-e.originalScrollY),n=i+e.adHeight,a=t.left-(window.scrollX-e.originalScrollX);return{top:i,bottom:n,left:a,right:a+e.adWidth,width:e.adWidth,height:e.adHeight}},ae="btr_client",se="cod_client",oe="sfImpression",re="LightAdImpression",de="viewablelatency",le=(e,t,i)=>({csaKey:e,csmKey:t,csmMessage:i}),ce=le("bodyBegin","bb",oe),me=(le("bodyBegin","bb",re),le("bodyEnd","be"),le("clickToATF","af"),le("criticalFeature","cf"),le("criticalFeature","cf",oe),le("criticalFeature","cf",re),le("loaded","ld"),le("loaded","ld",oe),le("loaded","ld",re),le("viewablelatency:bodyBegin","bb",de)),pe=le("viewablelatency:loaded","ld",de),he=e=>null==e?void 0:e.replace("criticalFeature","").replace("windowOnLoad","").replace("spATFEvent","").replace("r2OnLoad","").replace("aboveTheFold","").replace("af","").replace("visible",""),ue=e=>{const t=he(e);return""===t||"immediate"===t},ve=async(e,t)=>{e=he(null!=e?e:"");const i="undefined"!=typeof P,n=/^reached(\d{1,5}px)FromTop$/g.exec(e);if(!ue(e)){if(e.match("[^:]+:.+")){const t=e.split(":"),n=t[1],a=t.length>2?t[2]:n;if(i)return await new Promise((e=>P.when(a,"A").execute(e)));throw new Error("Need AUI or AmazonJQ installed")}return e.match(/^\d{1,4}px$/g)?await fe(parseInt(e,10),t,((e,t)=>{const i=W(e);return e&&i<=t})):n?await fe(parseInt(n[1],10),t,we):void h(`Unknown delay pattern ${e}`)}},we=(e,t)=>window.scrollY+B()>=t,fe=async(e,t,i)=>new Promise((n=>{const a=()=>{i(t,e)&&(n(),window.removeEventListener("scroll",s),window.removeEventListener("resize",s))},s=b(y(20,(()=>{a()})),h);window.addEventListener("scroll",s),window.addEventListener("resize",s),a()})),ge=(e,t,i,n,a,s)=>{const o=null==e?void 0:e[t];(null==o?void 0:o.valid)&&(o.loaded=!0,o.viewed&&(g().sendLatencyMetric({latencyMetricType:pe,placementId:n,placementName:i,placementDivId:a,timestamp:new Date(s)}),T("htmlviewed:loaded",{id:n,name:i})))},ye=e=>{window.addEventListener("scroll",e),window.addEventListener("resize",e),document.addEventListener("visibilitychange",e)};class be{constructor(e,t){this.weblabsWindow=e,this.prefix=t,this.isT1=()=>"t1"===this.weblabTreatment(),this.isT2=()=>"t2"===this.weblabTreatment(),this.isT3=()=>"t3"===this.weblabTreatment(),this.isT4=()=>"t4"===this.weblabTreatment(),this.isT5=()=>"t5"===this.weblabTreatment(),this.weblabTreatment=()=>{var e,t,i;return null===(i=this.weblabsWindow)||void 0===i||null===(t=i.renderingWeblabs)||void 0===t||null===(e=t[this.prefix])||void 0===e?void 0:e.toLowerCase()}}}const Ie=()=>new be(window,"ADPT_SF_TRANSPARENCY_INFO_MANDATORY_FOR_EU_712921"),Se=()=>new be(window,"ADPT_SF_FIXED_POS_INT_OBSERVER_1106762"),Ae=async(e,t)=>{let i,n;return new Promise((a=>{n=a,i=new IntersectionObserver((t=>{t.forEach((t=>{t.target===e&&t.isIntersecting&&(n(t),i.unobserve(e))}))}),t),i.observe(e)}))},Ee=async(e,t)=>{const i=_(e,t),n={root:Me(i)?null:document.documentElement};await Ae(i,n)},Me=e=>{if(Se().isT1()){let t=e;for(;t;){if("fixed"===window.getComputedStyle(t,null).getPropertyValue("position"))return!0;t=t.parentElement}return!1}if(Se().isT2()){return!!document.querySelector("[data-adpt-sf-fixed-position]")}return!1},xe=async(e,t)=>{t.options.firePixelsAfter&&await ve(t.options.firePixelsAfter,t.placement),await Ee({[t.options.arid]:t},t.options.arid),e.sendMessageToAd(t.options.arid,"fireImpression",{measurementMethod:se,isNoInventory:!1})},ke=(e,t,i)=>{const n=t[i].options,a=_(t,i),s=te(n.mediaType,n.size);if(a){const t=J(a);t.viewabilityStandards=s,e.sendMessageToAd(i,"updateViewability",t)}},Pe=(e,t,i,n)=>{const a=t[i].options,s=te(a.mediaType,a.size),o=ie(n);o.viewabilityStandards=s,e.sendMessageToAd(i,"updateViewability",o)},Te=(e,t)=>{const i=_(e,t);return{initialBoundingRect:(n=i).getBoundingClientRect(),adHeight:n.offsetHeight,adWidth:n.offsetWidth,originalScrollX:window.scrollX,originalScrollY:window.scrollY};var n},Ne=async(e,t,i,n)=>{i.options.firePixelsAfter&&await ve(i.options.firePixelsAfter,i.placement),await Ee(t.adMap,i.options.arid),n.measurementMethod===ae&&e.sendMessageToAd(i.options.arid,"fireImpression",{measurementMethod:ae,isNoInventory:n.isNoInventory}),Le(e,t,i,n.isNoInventory)},Le=(e,t,i,n)=>{n?((e,t,i)=>{const n=Te(t.adMap,i.options.arid);t.adMap[i.options.arid].noInventorySlotSnapshot=n,Pe(e,t.adMap,i.options.arid,n),e.sendMessageToAd(i.options.arid,"collapseSlot",{});const a=t.ADS_HANDLERS[i.options.arid];a.noInventoryViewabilityTracker=()=>{y(20,Pe)(e,t.adMap,i.options.arid,n)},ye(a.noInventoryViewabilityTracker)})(e,t,i):((e,t,i)=>{ke(e,t.adMap,i.options.arid);const n=t.ADS_HANDLERS[i.options.arid];n.viewabilityTracker=()=>{y(50,ke)(e,t.adMap,i.options.arid)},ye(n.viewabilityTracker),new IntersectionObserver((()=>{ke(e,t.adMap,i.options.arid)}),{threshold:[0,.5,1]}).observe(i.placement)})(e,t,i)},De=({height:e,width:t,targetWidth:i})=>0===t||isNaN(e)||isNaN(t)||isNaN(i)?0:Math.round(i*e/t),Ce=e=>!e||ze(e)||_e(e)?e:e+"px",ze=e=>e.length>1&&"%"===e.charAt(e.length-1),_e=e=>e.length>2&&"px"===e.substring(e.length-2),Fe=e=>ze(e)?e:`${parseInt(e)}px`,Re=(e,t)=>{const i=new Set(["bf4ab3db-618a-4853-ae89-3ad3bd17df16","dd4c5e61-fe9a-4d91-9deb-25fa60557719","da326e4a-90bd-4da3-a526-53301eb2c6a0","ca609359-3cb9-4984-8830-231c22e978d3","15554fd8-4c3e-45c6-ae61-84c65966f5d1","1396c5b8-45a1-4618-9a09-0b84209807f9","d9fb239d-fcde-414f-98a8-409c81052388","b60ea84b-3e24-44dc-9fdb-35bb2fb1fe5c","75b4c7aa-4c22-49d3-8371-15ca116eaf1f","ef368293-2611-4cef-8050-4fcd9b97f12e","db5cbac6-5194-4b52-9929-9ec0bbfed990","6479c6f3-a9c2-4d7c-9d1a-45008113fe0c"]);new be(window,"A2I_HOMEPAGE_CARD_THEMING_360311").isT1()&&i.has(e)&&(t&&(t.style.background="linear-gradient(to right, #FFC266, #B0E4AB)"),t&&(t.style.margin="0px"))},He="nav-ewc-persistent-hover",Be=()=>null!==document.querySelector(`.${He}`),$e=e=>"attributes"===e.type&&"class"===e.attributeName&&e.target.classList.contains(He),We=e=>{if(Be())return void Oe(e);new MutationObserver(((t,i)=>{if(t.some($e))try{Oe(e),i.disconnect()}catch(n){h("Failed to resize ILM for EWC.",n)}})).observe(window.document.documentElement,{attributes:!0,attributeFilter:["class"]})},Oe=e=>{const t=document.querySelector("div#nav-flyout-ewc");if(null===e||null===t)return void h(`could not find placementDiv (value was: ${e}) or ewc (value was: ${t})`);const i=t.offsetWidth;Ue(e,i)},Ue=(e,t)=>{var i,n;const a=document.createElement("style");a.innerHTML=`@media screen and (min-width: 1500px) { div[id$=${e.id}] {\n        width: calc(100vw - ${t+5}px) !important;\n        margin-left: calc(-50vw + 50% + ${t/2}px) !important;\n        margin-right: calc(-50vw + 50% + ${t/2}px) !important;\n    `,null===(n=document)||void 0===n||null===(i=n.body)||void 0===i||i.appendChild(a)},qe=["desktop-detail-ilm","fresh-desktop-detail-ilm","wfm-desktop-detail-ilm","vindp-desktop-atf-ilm"],Ve=["mobile-detail-ilm","mobile-app-detail-ilm","fresh-mobile-detail-ilm","fresh-mobile-detail-ilm-v1","wfm-mobile-detail-ilm-v1"],Je=["asr-indie-manga-banner","asr-indie-fliptoon-banner","asr-managed-fliptoon-banner","fresh-ad-left","fresh-ad-left-2","alm-wfm-fresh-ad-left","wfm-ad-left-2","alm-monoprix-fresh-ad-left","alm-morrisons-fresh-ad-left","alm-dia-fresh-ad-left","merchandised-search-top-1","merchandised-search-7","auto-left-advertising-1","auto-left-advertising-2","gwm-atf-dashboard","alm-tegut-ad-left","alm-life-ad-left"];class Ye{resize(e){var t;if(!this.isAllowedSize(e))return void h(`Size w:'${e.width}', h:'${e.height}' is not allow-listed for '${this.name}'`);const i=this.wrapperDiv,n=this.div,a=this.safeframe;null==i||i.removeAttribute("style"),i&&(i.style.overflow="hidden"),i&&(i.style.backgroundColor="white"),n.removeAttribute("style"),n.style.lineHeight="0",!i&&(n.style.marginBottom="20px"),n.style.marginLeft="auto",n.style.marginRight="auto",n.style.maxHeight="inherit",n.style.maxWidth=i?"min(100vh, 100vw)":"inherit",n.style.position="relative",a.style.height="100%",a.style.width="100%",a.removeAttribute("height"),a.removeAttribute("width"),a.style.removeProperty("min-width"),a.style.removeProperty("max-height"),a.style.removeProperty("padding-bottom"),null===(t=this.card)||void 0===t||t.style.setProperty("padding","0"),ze(e.height)||ze(e.width)?(n.style.height=Fe(e.height),n.style.width=Fe(e.width)):n.style.aspectRatio=`${parseInt(e.width)} / ${parseInt(e.height)}`,this.resizeHandleSpecialCases(e),Re(this.id,this.wrapperDiv)}collapse(){this.wrapperDiv&&(this.wrapperDiv.style.display="none"),this.div.style.display="none"}resizeHandleSpecialCases(e){const t=this.div;if(Xe(this.slotName,e))t.style.maxWidth=Fe(e.width);else if(Ke(this.slotName)){var i;const e=this.wrapperDiv;null==e||e.style.setProperty("width","100vw"),null==e||e.style.setProperty("margin-left","calc(-50vw + 50%)"),null==e||e.style.setProperty("margin-right","calc(-50vw + 50%)"),t.style.removeProperty("aspect-ratio"),t.style.removeProperty("max-width"),t.style.height="50px",null===(i=t.closest(".a-container"))||void 0===i||i.style.setProperty("padding-top","0")}else if(je(this.slotName)){t.style.removeProperty("aspect-ratio"),t.style.removeProperty("max-width"),t.style.height="55px",t.style.width="100vw",t.style.marginLeft="calc(-50vw + 50%)",t.style.marginRight="calc(-50vw + 50%)",Be()&&(t.style.width="100%",t.style.removeProperty("margin-left"),t.style.removeProperty("margin-right"));const e=document.createElement("style");e.innerHTML=`@media screen and (max-width: 1000px) {div[id$=${this.div.id}] { width: 100% !important; margin-left: 0 !important; margin-right: 0 !important; }}`,this.div.prepend(e);const i=document.createElement("style");i.innerHTML=`#${t.id}_Feedback { margin-right: 10px; }`,t.prepend(i)}else"alm-morrisons-storefront-desktop-ad-1"===this.slotName||"alm-morrisons-storefront-desktop-ad-2"===this.slotName||"alm-monoprix-storefront-desktop-ad-1"===this.slotName||"alm-monoprix-storefront-desktop-ad-2"===this.slotName||"alm-dia-storefront-desktop-ad-1"===this.slotName||"alm-dia-storefront-desktop-ad-2"===this.slotName||"alm-storefront-desktop-ad-1"===this.slotName||"alm-storefront-desktop-ad-2"===this.slotName||"alm-wfm-storefront-desktop-ad-1"===this.slotName||"alm-wfm-storefront-desktop-ad-2"===this.slotName?(this.div.style.maxWidth="300px",this.div.style.marginTop="47px",this.div.style.removeProperty("margin-left"),this.div.style.removeProperty("margin-right")):"hero-quick-promo"!==this.slotName&&"fresh-hero-quick-promo"!==this.slotName&&"wfm-hero-quick-promo"!==this.slotName||(this.div.style.maxWidth="650px",this.div.style.removeProperty("margin-left"),this.div.style.removeProperty("margin-right"))}get wrapperDiv(){return this.wrapperDivId?document.getElementById(this.wrapperDivId):null}get div(){return document.getElementById(this.divId)}get safeframe(){return document.getElementById(this.safeframeId)}get card(){return document.getElementById(`ape_${this.name}_aui_card`)}constructor(e,t,i,n,a,s,o){this.id=e,this.name=t,this.wrapperDivId=i,this.divId=n,this.safeframeId=a,this.slotName=s,this.allowedSizes=o,this.isAllowedSize=e=>this.allowedSizes.some((t=>Fe(e.height)===t.height&&Fe(e.width)===t.width))}}const je=e=>qe.includes(e),Ke=e=>Ve.includes(e),Xe=(e,t)=>970===parseInt(t.width)||980===parseInt(t.width)||728===parseInt(t.width)||Je.includes(e),Ge=e=>Ze(e,[]),Ze=(e,t)=>{var i;return new Ye(e.placementId,e.placementName,e.adUnitWrapperId,e.adUnitPlacementId,e.adUnitIframeId,e.slotName,(null!==(i=e.allowedSizes)&&void 0!==i?i:[]).concat({height:Fe(e.size.height),width:Fe(e.size.width)}).concat(t.map((e=>({height:Fe(e.height),width:Fe(e.width)})))))},Qe="expanded-feedback-label",et="expanded-safeframe",tt="expandable-ads-styles",it=(e,t,i)=>{const n=lt(t,Ge(e.options).div.offsetWidth),a={height:Ce(n),width:Ce(e.options.size.width)},s=Ze(e.options,[a]);s.resize(a),dt(e.options),st(e.options),s.div.style.height=a.height,ct(e,i,at)},nt=(e,t,i)=>{const n=Ge(e.options).div.offsetHeight;it(e,t,i);const a=Ge(e.options);a.div.style.zIndex="2",a.div.style.position="relative",a.div.parentElement&&a.div.parentElement.style.removeProperty("overflow"),a.div.parentElement&&(a.div.parentElement.style.height=n+"px")},at=e=>{Ge(e.options).resize(e.options.size),rt(e.options)},st=e=>{const t=document.getElementById(e.adUnitIframeId),i=ot(t);if(null===i||null===t)throw new Error(`feedbackWrapper: ${i?"present":"missing"}, safeFrame: ${t?"present":"missing"}`);i.classList.add(Qe),t.classList.add(et)},ot=e=>{var t;let i=null==e?void 0:e.parentElement;return(null==i||null===(t=i.parentElement)||void 0===t?void 0:t.id.endsWith("_wrapper"))&&(i=i.parentElement),i.querySelector("div[id$=_Feedback]")},rt=e=>{const t=document.getElementById(e.adUnitIframeId),i=ot(t);null!==i&&null!==t&&(i.classList.remove(Qe),t.classList.remove(et))},dt=e=>{(e=>{if(null!==document.querySelector(`#${tt}`))return;const t=document.createElement("style");t.id=tt,t.innerHTML=`\n        div.${Qe} {\n            background-color: white;\n            z-index: 2;\n            margin-top: 0px !important;\n            padding-top: 2px !important;\n        }`,document.getElementById(e.adUnitPlacementId).appendChild(t)})(e)},lt=(e,t)=>(e.staticHeight?parseInt(e.staticHeight,10):0)+(ze(e.width)?parseInt(e.height,10):De({height:parseInt(e.height,10),width:parseInt(e.width,10),targetWidth:t})),ct=(e,t,i)=>{const n=n=>{mt(n,e,t),i(e)};window.addEventListener("scroll",n,{once:!0}),window.addEventListener("click",n,{once:!0}),window.addEventListener("swipe",n,{once:!0}),window.addEventListener("tap",n,{once:!0})},mt=(e,t,i)=>{i.sendMessageToAd(t.options.arid,"triggerEventInIframe",{eventType:e.type})},pt=e=>e+"_Feedback";class ht{async addSponsoredLabelWithFeedbackLink(e,t){e.appendChildTo(this.parentHtmlId,this);const i=await t.getSponsoredLabelAndFeedbackLink(this.urlPathAndParameter);if(!(null==i?void 0:i.isOk()))throw new Error(`Result from the feedback service was not ok ${this.urlPathAndParameter}`);e.updateElement(this.getHtmlId(),i)}getHtmlId(){return pt(this.parentHtmlId)}isHidden(){return this.hidden}exists(e){return e.exists(this.getHtmlId())}constructor(e,t,i,n,a,s,o){this.parentHtmlId=e,this.feedbackStyle=t,this.labelText=i,this.labelStyle=n,this.position=a,this.urlPathAndParameter=s,this.hidden=o}}class ut{open(e){e.clickChildLink(this)}getHtmlId(){return pt(this.parentHtmlId)}constructor(e){this.parentHtmlId=e}}class vt{async createSponsoredLabelWithFeedbackLink(e,t){if(!e.exists(this.feedbackHtmlPort)){t.request();try{await e.addSponsoredLabelWithFeedbackLink(this.feedbackHtmlPort,this.feedbackApiPort),t.success(),e.isHidden()||t.labelRenderedHost()}catch(i){throw t.error(),i}}}openModal(e){e.open(this.feedbackHtmlPort)}labelRendered(e){e.labelRenderedCreative()}removeSponsoredLabelAndFeedbackLink(e){try{var t;null===(t=document.getElementById(pt(e)))||void 0===t||t.remove()}catch(i){h("Unable to remove AdFeedback Div",i)}}logTransparencyInfoMissing(e){e.transparencyInfoMissing()}constructor(e,t){this.feedbackHtmlPort=e,this.feedbackApiPort=t}}var wt=function(e){if(window.csa)try{window.csa("Events",{producerId:"adplacements"})("setEntity",{adCreativeMetaData:e})}catch(t){h("Error with 'setEntity' CSA",t)}},ft=function(e,t,i){if(void 0===i&&(i=1),window.csa)try{window.csa("Events",{producerId:"adplacements"})("log",{schemaId:"ApeSafeframe.csaEvent.1",metricName:e+":"+t.name+":"+t.id,metricValue:i},{ent:"all"})}catch(n){h("Error with 'logCsaEvent' CSA",n)}};const gt=e=>new Lt(e),yt="adfeedback_request",bt="adfeedback_success",It="adfeedback_error",St="adfeedback_sponsoredlabelrendered_creative",At="adfeedback_sponsoredlabelrendered_host",Et="adfeedback:request",Mt="adfeedback:success",xt="adfeedback:error",kt="adfeedback:sponsoredlabelrendered:creative",Pt="adfeedback:sponsoredlabelrendered:host",Tt="adfeedback:sponsoredlabelrendered",Nt="adfeedback:transparencyinfo:missing";class Lt{request(){T(Et,this.placement),N(Et),ft(yt,this.placement)}success(){T(Mt,this.placement),N(Mt),ft(bt,this.placement)}error(){T(xt,this.placement),ft(It,this.placement)}labelRenderedCreative(){T(kt,this.placement),N(Tt),ft(St,this.placement)}labelRenderedHost(){T(Pt,this.placement),N(Tt),ft(At,this.placement)}transparencyInfoMissing(){T(Nt,this.placement),N(Nt)}constructor(e){this.placement=e}}class Dt{isOk(){return"ok"===this.status}constructor(e,t,i){this.status=e,this.html=t,this.script=i}}class Ct{async getSponsoredLabelAndFeedbackLink(e){const t=await fetch(this.windowRepo.origin()+e);if(t.ok){const e=await t.json();return new Dt(e.status,e.html,e.script)}throw Error("Could not fetch the feedback html/link/script/label")}constructor(e){this.windowRepo=e}}class zt{appendChildTo(e,t){var i,n;function a(e,t){const i=document.createElement("div");return i.setAttribute("id",t.getHtmlId()),i.classList.add("ape-feedback"),i.style.position="relative",i.style.height="20px",i.style.textAlign=i.id.includes("hero-quick-promo_Desktop_placement_Feedback")?"left":"right",i.style.padding="0",i.style.marginTop="2px",i.style.display=t.feedbackStyle.display,e.endsWith("_wrapper")&&(!e.includes("-ilm")&&(i.style.maxWidth="min(100vh, 100vw)"),i.style.marginLeft="auto",i.style.marginRight="auto",i.style.padding="0 5px"),i.append(function(e){const t=document.createElement("div");return t.innerHTML=e.labelText,_t(t,e.labelStyle),t}(t)),i}1===t.position?null===(i=document.getElementById(e))||void 0===i||i.prepend(a(e,t)):0===t.position&&(null===(n=document.getElementById(e))||void 0===n||n.append(a(e,t)))}updateElement(e,t){const i=document.getElementById(e);if(i){i.innerHTML=t.html,Ft(i,t);for(const e of i.children)"DIV"===e.tagName?e.removeAttribute("style"):"A"===e.tagName&&(e.style.removeProperty("position"),e.style.removeProperty("top"),e.style.removeProperty("right"),e.style.removeProperty("display"))}}clickChildLink(e){const t=document.getElementById(e.getHtmlId());for(const n of(null==t?void 0:t.children)||[])if("A"===(i=n).tagName||"DIV"===i.tagName)return void n.click();var i}exists(e){return!!document.getElementById(e)}}const _t=(e,t)=>{for(const i in t)e.style.setProperty(i,t[i])},Ft=(e,t)=>{Rt(e).innerHTML=t.script},Rt=e=>{const t=document.createElement("script");return e.prepend(t),t},Ht={code:"BE",hostname:"www.amazon.com.be",name:"Belgium"},Bt={code:"FR",hostname:"www.amazon.fr",name:"France"},$t={code:"DE",hostname:"www.amazon.de",name:"Germany"},Wt={code:"IT",hostname:"www.amazon.it",name:"Italy"},Ot={code:"NL",hostname:"www.amazon.nl",name:"Netherlands"},Ut={code:"PL",hostname:"www.amazon.pl",name:"Poland"},qt={code:"ES",hostname:"www.amazon.es",name:"Spain"},Vt={code:"SE",hostname:"www.amazon.se",name:"Sweden"},Jt=e=>location.hostname===e.hostname,Yt=e=>!(Jt(Ht)||Jt(Bt)||Jt($t)||Jt(Wt)||Jt(Ot)||Jt(Ut)||Jt(qt)||Jt(Vt))||jt(e),jt=e=>{var t,i,n,a,s,o;const r=[];Xt(null==e||null===(n=e.url)||void 0===n||null===(i=n.parameters)||void 0===i||null===(t=i.adPlacementMetaData)||void 0===t?void 0:t.slotName)&&r.push("DSA Error: slotName missing");const d=null==e||null===(o=e.url)||void 0===o||null===(s=o.parameters)||void 0===s||null===(a=s.adCreativeMetaData)||void 0===a?void 0:a.adCreativeDetails;(!d||d.length<=0)&&r.push("DSA Error: transparency info missing"),null==d||d.every((e=>Kt(e,r)));for(const l of r)for(let e=0;e<Gt();e++)h(l);return r.length<=0},Kt=(e,t)=>{var i,n,a,s,o;e.version||t.push("DSA Error: version missing"),Xt(e.advertiserIdNS)&&t.push("DSA Error: advertiserIdNS missing"),void 0!==(null===(i=e.selectionSignals)||void 0===i?void 0:i.context)&&null!==(null===(n=e.selectionSignals)||void 0===n?void 0:n.context)||t.push("DSA Error: selectionSignals.context missing"),void 0!==(null===(a=e.selectionSignals)||void 0===a?void 0:a.location)&&null!==(null===(s=e.selectionSignals)||void 0===s?void 0:s.location)||t.push("DSA Error: selectionSignals.location missing"),Xt(null===(o=e.selectionSignals)||void 0===o?void 0:o.pastActivity)&&t.push("DSA Error: selectionSignals.pastActivity missing")},Xt=e=>!e||e.length<=0,Gt=()=>Ie().isT1()?2:Ie().isT2()?4:Ie().isT3()?8:Ie().isT4()?16:Ie().isT5()?32:1,Zt=()=>new Qt(new vt(new zt,new Ct({origin:()=>window.location.origin})));class Qt{async addSponsoredLabel({parentHtmlId:e,placement:t,feedback:i}){return Yt(i)?(i.hidden&&(Object.assign(i.style,{display:"none"}),Object.assign(i.label.style,{display:"none"})),await this.feedbackService.createSponsoredLabelWithFeedbackLink(ei(e,i),gt(t)),!0):(this.feedbackService.logTransparencyInfoMissing(gt(t)),h("Transparency Information missing"),!1)}openModal(e){this.feedbackService.openModal(new ut(e))}labelRendered({placement:e}){this.feedbackService.labelRendered(gt(e))}removeSponsoredLabelAndFeedbackLink(e){this.feedbackService.removeSponsoredLabelAndFeedbackLink(e)}constructor(e){this.feedbackService=e}}const ei=(e,t)=>{const i=JSON.parse(JSON.stringify(t.url.parameters));return i.adPlacementMetaData.pageUrl=E(i.adPlacementMetaData.pageUrl),new ht(e,t.style,t.label.text,t.label.style,"TOP"===t.position?1:0,"/af/feedback-link?pl="+encodeURIComponent(JSON.stringify(i)),t.hidden)},ti=e=>{Zt().labelRendered({placement:{id:e.options.placementId,name:e.options.placementName}})},ii=e=>{Zt().openModal(e.options.adPlacementMetaData.adElementId)},ni=e=>{Zt().removeSponsoredLabelAndFeedbackLink(e.options.adPlacementMetaData.adElementId)},ai=async e=>Zt().addSponsoredLabel(si(e)),si=e=>{const t=e.adPlacementMetaData,i=e.adFeedbackInfo;var n;return{parentHtmlId:null!==(n=e.adUnitWrapperId)&&void 0!==n?n:e.adUnitPlacementId,placement:{id:e.placementId,name:e.placementName},feedback:{position:i.adFeedbackOnTop?"TOP":"BOTTOM",hidden:!i.boolFeedback,style:e.feedbackDivStyle,url:{parameters:{adPlacementMetaData:{adElementId:t.adElementId,pageType:t.pageType,pageUrl:E(t.pageUrl),slotName:t.slotName},adCreativeMetaData:e.adCreativeMetaData}},label:{text:A(i.sponsoredText),style:e.advertisementStyle}}}},oi="gw-video-orchestrator",ri=(e,t,i)=>{var n;null===(n=window.P)||void 0===n||n.when(oi).execute((n=>{try{n.subscribe(e,t,i)}catch(a){a instanceof Error?p(`gw-video-orchestrator error: ${a.message}`):p(`gw-video-orchestrator error: ${a}`)}}))},di=e=>{var t;null===(t=window.P)||void 0===t||t.when(oi).execute((t=>{t.elect(e)}))};let li=null;function ci(e,t,i){const n=t=>{i.sendCustomMessageToAd(e.options.arid,"videoAutoplayResponse",t)};var a;(a=e.options.pageType)&&"gateway"===a.toLowerCase()?ri(e.iframe,n,t):li===e.options.arid?n(!0):null===li&&function(e){const t=document.getElementsByTagName("video");for(let i=0;i<t.length;++i)if(!t[i].paused&&ee(e,t[i]))return!1;return!0}(e.iframe)?(li=e.options.arid,n(!0)):n(!1)}function mi(){di(),li=null}function pi(e){var t;t=e.iframe,di(t),li=e.options.arid}var hi=function(t,i,n){ui()&&(vi(wi(t,i.id,n)),vi(wi(t,e(i.name),n)))},ui=function(){var e;return"function"==typeof(null===(e=null===window||void 0===window?void 0:window.ue)||void 0===e?void 0:e.tag)},vi=function(e){var t;return null===(t=null===window||void 0===window?void 0:window.ue)||void 0===t?void 0:t.tag(e)},wi=function(e,t,i){return"".concat(e,":").concat(t).concat(fi(i))},fi=function(e){return e?":".concat(e):""};const gi="aUAZqFtiIp6VxqpW3coqZ2JdZnV3RN9S8yKMRIdJ",yi=(e,t,i)=>{bi(Ii(e,i,Si(t)))},bi=e=>{new be(window,"ADPT_SF_METRICS_LOGGING_1100263").isT1()&&navigator.sendBeacon&&navigator.sendBeacon(`https://e5qq6zj76g.execute-api.us-east-1.amazonaws.com/metric?x-api-key=${gi}`,JSON.stringify(e))},Ii=(e,t,i)=>({metricName:e,count:t,dimensions:i,xApiKey:gi}),Si=e=>{var t,i;return{app:"SF",siteName:e.siteName,slotName:e.slotName,pageType:e.pageType,subPageType:e.subPageType,placementId:e.placementId,mediaType:e.mediaType,programId:null===(t=e.adCreativeMetaData)||void 0===t?void 0:t.adProgramId,creativeTemplateName:null===(i=e.adCreativeMetaData)||void 0===i?void 0:i.adCreativeTemplateName,deviceType:e.deviceType,userAgent:navigator.userAgent}},Ai=(e,t,i)=>{if(""===t)throw new Error("Invalid queryParamKey input to addJSONQueryParamToURL: "+JSON.stringify({queryParamKey:t}));const n=new URL(e),a=n.searchParams.get(t),s=a||"{}",o=JSON.parse(s),r=Object.assign(o,i);return n.searchParams.set(t,JSON.stringify(r)),n.toString()},Ei=({abpAcceptable:e="false",abpStatus:t="-1"})=>"true"===e&&("1"===t||"-1"===t);class Mi{async fire(e){this.isFired||(await fetch(this.pixelUrl(this.url,e),{keepalive:!0,mode:"no-cors"}),e.div.appendChild(this.pixel(e)),this.isFired=!0)}shouldFirePixel(e){return!0}constructor(e,t,i){this.url=e,this.isFired=!1,this.pixel=e=>{const t=document.createElement("img");return t.id=`${this.pixelId}_${e.name}`,t.style.display="none",t.setAttribute("pixel-url",this.pixelUrl(this.url,e)),t},this.shouldAppendABPTag=Ei({abpAcceptable:t,abpStatus:i})}}class xi extends Mi{constructor(e,t,i){super(e,t,i),this.pixelId="ape_impression",this.pixelUrl=(e,t)=>Ai(e,"pj",this.pixelUrlParameters(t)),this.pixelUrlParameters=e=>({measurementMethod:se,ape_al:!!this.shouldAppendABPTag||void 0})}}class ki{constructor(e,t){this.hms=e,this.hc=t,this.changeSize=(e,t)=>{yi("resize:size:changeSize",e.options);Ge(e.options).resize(t)},this.startBTRPixelTracking=async(e,t)=>{await Ne(this.hms,this.hc,e,t)},this.fireImpressionWithDelay=async e=>{await xe(this.hms,e)},this.logAPIInvocation=(e,t)=>{const i=`messenger:${t.apiName}`;N(i),T(i,{id:e.options.placementId,name:e.options.placementName})},this.logError=(e,t)=>{h(t.message+": "+e.options.placementName,t.error)},this.logFatal=(e,t)=>{var i,n;i=t.message+": "+e.options.placementName,n=t.error,console.error(i,JSON.stringify(n)),u("FATAL",i,v(i,n))},this.logCsaEvent=(e,t)=>{ft(t.metricName,{name:e.options.placementName,id:e.options.placementId})},this.addCsaEntity=(e,t)=>{wt(t)},this.sendLatencyMetric=(e,t)=>Pi(e,t),this.customMessage=(e,t)=>{this.hms.customMessage(t.key,t.body,["openPsAdPopover","openATCModal","setPartner","sendMetrics","wrap"],e.options.placementName,e.options.placementId)},this.fireViewableLatencyMetrics=async(e,t)=>{ge(this.hc.viewableLatencyTrackers,e.options.arid,e.options.placementName,e.options.placementId,e.options.adUnitPlacementId,t.adLoadedTimestamp)},this.countMetric=(e,t)=>{t.isGlobal?N(t.metricMsg,t.value):T(t.metricMsg,{id:e.options.placementId,name:e.options.placementName},t.value)},this.addCsmTag=(e,t)=>{var i,n;t.isGlobal?(i=t.tag,n=t.msg,ui()&&vi(i+fi(n))):hi(t.tag,{id:e.options.placementId,name:e.options.placementName},t.msg)},this.requestVideoAutoplay=async(e,t)=>{ci(e,t,this.hms)},this.releaseVideoAutoplay=async()=>{mi()},this.haveVideoAutoplayPermission=async e=>{pi(e)},this.feedbackLabelRendered=e=>{ti(e)},this.feedbackOpenModal=e=>{ii(e)},this.removeSponsoredLabelAndFeedbackLink=async e=>{ni(e)},this.expandAdSlot=(e,t)=>{it(e,t,this.hms)},this.expandAdSlotWithOverlap=(e,t)=>{nt(e,t,this.hms)},this.resetSlotSize=e=>{at(e)},this.triggerEventInIframe=(e,t)=>{this.hms.sendMessageToAd(e.options.arid,"triggerEventInIframe",{eventType:t.event.type})},this.safeFrameReady=e=>{var t,i;null===(i=performance)||void 0===i||null===(t=i.mark)||void 0===t||t.call(i,`SafeFrame:  safeFrameReady ${e.options.slotName}`),this.hms.sendMessageToAd(e.options.arid,"setupComputedAdDetails",{computed:{aPageStart:window.aPageStart,adStartTime:(new Date).getTime()}})},this.sendEventAddedCreative=async e=>{var t;e.options.firePixelsAfter&&"immediate"!==e.options.firePixelsAfter&&await ve(e.options.firePixelsAfter,e.placement),await Ee({[e.options.arid]:e},e.options.arid),(t=Ti(e.options),new xi(t.aaxImpPixelUrl,t.abpAcceptable,t.abpStatus)).fire({id:e.options.placementId,name:e.options.placementName,div:e.placement})}}}const Pi=(e,{latencyMetricType:t,timestamp:i})=>{g().sendLatencyMetric({latencyMetricType:t,placementName:e.options.placementName,placementId:e.options.placementId,placementDivId:e.options.adUnitPlacementId,timestamp:i})},Ti=e=>{var t,i,n,a,s;return{aaxImpPixelUrl:e.aaxImpPixelUrl,aaxInstrPixelUrl:e.aaxInstrPixelUrl,aPageStart:null!==(n=null===(t=e.computed)||void 0===t?void 0:t.aPageStart)&&void 0!==n?n:0,adStartTime:null!==(a=null===(i=e.computed)||void 0===i?void 0:i.adStartTime)&&void 0!==a?a:0,abpAcceptable:e.abpAcceptable,abpStatus:null!==(s=e.abpStatus)&&void 0!==s?s:"-1",btrPixelUrl:e.btrPixelUrl,skAdNetwork:e.skAdNetwork}},Ni=e=>{const t=document.getElementById(e);void 0!==t&&t&&(t.style.display="none")};class Li extends ki{constructor(e,t){super(e,t),this.collapseSlot=async e=>{var t,i;(Ni(this.hc.AD_IDS[e.options.arid].placementDivId),Ni(this.hc.AD_IDS[e.options.arid].auiCardDeckId),"nav-sitewide-msg"===e.options.slotName)&&(await ve("amznJQ.available:navbarJSLoaded",e.placement),"function"==typeof(null===(i=parent)||void 0===i||null===(t=i.navbar)||void 0===t?void 0:t.unHideSWM)&&parent.navbar.unHideSWM())}}}const Di="adload:start",Ci=(e,t,i)=>e>0?i>e:t>0,zi=(e,t,i,n,a,s)=>{var o,r,d;const l=null===(d=document)||void 0===d||null===(r=d.getElementById)||void 0===r||null===(o=r.call(d,i))||void 0===o?void 0:o.getBoundingClientRect();if(l&&Ci(l.top,l.bottom,B())&&Ci(l.left,l.right,$())){if(g().sendLatencyMetric({latencyMetricType:me,placementId:a,placementName:n,placementDivId:i,timestamp:new Date}),e[s].loaded){g().sendLatencyMetric({latencyMetricType:pe,placementId:a,placementName:n,placementDivId:i,timestamp:new Date});const e={id:a,name:n};T("adplacements:htmlviewed:loaded:",e),T("adplacements:htmlviewed",e)}t.viewed=!0,c=t.tracker,window.removeEventListener("scroll",c),window.removeEventListener("resize",c),document.removeEventListener("visibilitychange",c)}var c},_i=(e,t,i,n,a)=>{if(!e[a]){e[a]={valid:!1};try{const s=e[a];zi(e,s,t,i,n,a);const o=b(y(20,(()=>{zi(e,s,t,i,n,a)})),h);ye(o),s.tracker=o,s.valid=!0}catch(s){throw h("Error initializing viewable latency instrumentation",s),s}}},Fi=e=>{N("resize:size:request"),e.creative.size?e.creative.size.height===parseInt(e.size.height)&&e.creative.size.width===parseInt(e.size.width)||(N("resize:size:differ"),yi("resize:size:differ",e)):(N("resize:size:missing"),yi("resize:size:missing",e)),(e=>{if(!e.creative.size)return!0;const t=e.creative.size;return e.slotSizes.some((e=>e.width===t.width&&e.height===t.height))})(e)||yi("creativesize:slotsizediffer",e)};class Ri{constructor(e,t,i,n){this.hc=e,this.hms=t,this.hmr=i,this.supportedCommands=n,this.initializeAdIds=e=>{var t,i;this.hc.AD_IDS[e.arid]=(t=e.placementName,i=e.scope,{slotId:t,wrapperDivId:`ape_${i}_wrapper`,placementDivId:`ape_${i}_placement`,iframeId:`ape_${i}_iframe`,textDivWrapperId:`ape_${i}_text-wrapper`,textDivId:`ape_${i}_text`,auiCardDeckId:`ape_${i}_aui_cardDeck`})},this.initializeAdMap=(e,t)=>{try{const i=document.getElementById(this.hc.AD_IDS[e.arid].placementDivId),n=this.hc.AD_IDS[e.arid].iframeId,a=document.getElementById(n);this.hc.adMap[e.arid]={placement:i,iframe:a,options:e,messagePort:t,hasTransferredMessagePort:!1}}catch(i){h(`Error creating safeFrame ${e.slotName}`,i)}},this.initAllSafeFrames=async()=>{var e,t;null===(t=performance)||void 0===t||null===(e=t.mark)||void 0===e||e.call(t,"SafeFrame: Start initAllSafeFrames"),this.getWindowSafeFrame()||(this.initWindowSafeFrame({registerCustomMessageListener:this.hms.registerCustomMessageListener,sendCustomMessage:this.hms.sendCustomMessage,secondPhaseLoadAd:this.secondPhaseLoadAd}),Wi(this.getWindowSafeFrame()))},this.secondPhaseLoadAd=async(e,t,i,n,a)=>{var s,o;null===(o=performance)||void 0===o||null===(s=o.mark)||void 0===s||s.call(o,`SafeFrame: Start secondPhaseLoadAd ${t.adUnitPlacementId}`),this.initializeAdIds(t),this.initializeAdMap(t,i);const r=this.hc,d=this.hms,l=this.hc.adMap[e].options;r.ADS_HANDLERS[l.arid]=r.ADS_HANDLERS[l.arid]||{};const c=Ge(l);c.resize(t.size),Fi(t),Ui(c,t);const m=this.hc.AD_IDS[e];if(_i(r.viewableLatencyTrackers,m.placementDivId,m.slotId,c.id,e),l.forcePunt)return hi("forcePunt",c),wt({forcePunt:"true"}),void c.collapse();Bi(l),Oi(c,m.placementDivId,n,a),T("adload:delayloadcallback",c),ft("adload_delayload",c);try{var p;new be(window,"ADPT_SF_SERVER_SIDE_SPONSORED_LABEL_998980").isT1()&&(null===(p=window.feedbackLabelFunctions)||void 0===p||p[l.adUnitWrapperId||l.adUnitPlacementId]()),await ai(l)?(Hi(r,l,this.hmr),$i(r,l,d)):c.collapse()}catch(h){throw c.collapse(),h}}}}const Hi=(e,t,i)=>{e.adMap[t.arid].messagePort.onmessage=i.receiveMessage},Bi=e=>{g().sendLatencyMetric({latencyMetricType:ce,placementId:e.placementId,placementName:e.placementName,placementDivId:e.adUnitPlacementId}),T(Di,{id:e.placementId,name:e.placementName}),N(Di),ft("adload_start",{id:e.placementId,name:e.placementName})},$i=(e,t,i)=>{var n;je((n=t).slotName)&&We(document.getElementById(n.adUnitPlacementId))},Wi=e=>{window.addEventListener("resize",(()=>{null==e||e.sendCustomMessage("resize",{height:window.innerHeight,width:window.innerWidth})}))},Oi=(e,t,i,n)=>{var a,s;i&&(r({latencyEvent:"wb",placement:e,timestamp:i}),r({latencyEvent:"bb",placement:e,timestamp:i}));const o=null===(s=document)||void 0===s||null===(a=s.getElementById)||void 0===a?void 0:a.call(s,t);n&&null!==o&&w(o,"bodyBegin",n)},Ui=(e,t)=>{try{T("coordinate:x",e,e.div.getBoundingClientRect().x),T("coordinate:y",e,e.div.getBoundingClientRect().y),yi("coordinate:x",t,e.div.getBoundingClientRect().x),yi("coordinate:y",t,e.div.getBoundingClientRect().y)}catch(i){return}},qi="custommessage:notallowlisted";class Vi{constructor(e,t={}){this.adMap=e,this.msgListeners=t,this.sendMessageToAd=(e,t,i)=>{const n={command:t,data:i};this.adMap[e].messagePort.postMessage(n)},this.customMessage=(e,t,i,n,a)=>{const s=this.msgListeners;try{"undefined"!==i&&Array.isArray(i)&&(i.indexOf(e)>-1&&s[e]?(N(`custommessage:allowlisted:${e}`),s[e](t)):-1===i.indexOf(e)?(N(qi),T(qi,{id:a,name:n})):h("Unrecognized custom message key: "+e))}catch(o){h("Custom Message Error",o)}},this.registerCustomMessageListener=(e,t,i)=>{let n=!1;const a=this.msgListeners;try{if(!a[e]||"function"!=typeof a[e]||i)a[e]=t,n=!0;else{const t=new Error("Custom message listener already exists for key: "+e);h("Duplicate Key",t)}}catch(s){h("Error registering custom message listener",s)}return n},this.sendCustomMessage=(e,t)=>{const i=this.adMap,n={key:e,data:t};for(const a in i)this.sendMessageToAd(a,"customMessage",n)},this.sendCustomMessageToAd=(e,t,i)=>{const n={key:t,data:i};this.sendMessageToAd(e,"customMessage",n)}}}class Ji{constructor(e={},t={},i={},n={}){this.adMap=e,this.ADS_HANDLERS=t,this.AD_IDS=i,this.viewableLatencyTrackers=n}}class Yi{constructor(e={},t){this.adMap=e,this.supportedCommands=t,this.receiveMessage=async e=>{const t=this.adMap,i=e.data,n=t[i.arid];try{const e=this.supportedCommands[i.command];e&&await e(n,i.data)}catch(a){const t="Problem with message: "+JSON.stringify(e.data);h(t,a)}}}}var ji,Ki;null===(Ki=performance)||void 0===Ki||null===(ji=Ki.mark)||void 0===ji||ji.call(Ki,"SafeFrame: SafeFrame: Starting DAsf");const Xi=new Ji,Gi=new Vi(null==Xi?void 0:Xi.adMap),Zi=new class extends Ri{constructor(e=new Ji,t=new Vi(e.adMap)){const i=new Li(t,e);super(e,t,new Yi(e.adMap,i),i),this.initWindowSafeFrame=e=>{window.DAsf=e},this.getWindowSafeFrame=()=>window.DAsf}}(Xi,Gi);b((()=>Zi.initAllSafeFrames()),h,"Error initializing safeFrame")()})();
//# sourceMappingURL=DAsf-1.50.ac9cfa0d.js.map
